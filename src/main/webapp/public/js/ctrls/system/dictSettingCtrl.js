// Generated by CoffeeScript 1.10.0
define(['can/control', 'can', 'Auth', 'base', 'reqwest', 'localStorage', 'bootbox', 'datatables.net', 'datatables.net-bs'], function(Ctrl, can, Auth, base, reqwest, localStorage, bootbox) {
  return Ctrl.extend({
    init: function(el, data) {
      if (!can.base) {
        new base('', data);
      }
      this.element.html(can.view('../public/view/home/system/dictSetting.html'));
      reqwest(Auth.apiHost + "dict/attributes?_=" + (Date.now())).then(function(data) {
        return _.each(data, function(dict) {
          var $button;
          $button = $("<a href='#' class='list-group-item' data-dictid='" + dict.dictId + "'>" + dict.dictValue + "</a>");
          return $("#dictList").append($button);
        });
      });
      $('#dictList').on('click', 'a.list-group-item', function(e) {
        $('#dictList a.active').removeClass('active');
        $(this).addClass('active');
        $('#paramAdd').removeClass('hide');
        $("#params li").remove();
        reqwest(Auth.apiHost + "dict/attributes/" + ($(this).data('dictid')) + "?_=" + (Date.now())).then(function(data) {
          return _.each(data, function(dict) {
            var $li;
            $li = $("<li class='list-group-item list-group-item-info' data-dictvalue='" + dict.dictValue + "'>" + dict.dictValue + "<button type='button' class='close'><span aria-hidden='true' class='pull-right'>&times;</span></button></li>");
            return $("#params").append($li);
          });
        });
        e.preventDefault();
        return e.stopPropagation();
      });
      $('#params').on('click', 'li.list-group-item>button', function(e) {
        return $(this).closest('li').remove();
      });
      $('#addBtn').unbind('click').click(function(e) {
        var $li, value;
        if (value = $('#addValue').val()) {
          $li = $("<li class='list-group-item list-group-item-info' data-dictvalue='" + value + "'>" + value + "<button type='button' class='close'><span aria-hidden='true' class='pull-right'>&times;</span></button></li>");
          $("#params").append($li);
          return $('#addValue').val('');
        }
      });
      return $('#saveBtn').unbind('click').click(function(e) {
        var params;
        params = [];
        $('#params li').each(function(index, li) {
          return params.push({
            dictId: index + 1,
            dictValue: $(this).data('dictvalue')
          });
        });
        return reqwest({
          url: Auth.apiHost + "dict/attributes/" + ($('#dictList a.active').data('dictid')),
          method: "put",
          contentType: 'application/json',
          data: JSON.stringify(params),
          type: 'html'
        }).then(function() {
          return bootbox.alert('保存成功');
        }).fail(function() {
          return bootbox.alert('保存失败！');
        });
      });
    }
  });
});
