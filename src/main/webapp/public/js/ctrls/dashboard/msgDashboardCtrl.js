// Generated by CoffeeScript 1.10.0
define(['can/control', 'can', 'base', 'Auth', 'reqwest', '_', 'datatables.net', 'datatables.net-bs', 'datatables.net-responsive', 'datatables.net-responsive-bs', 'datepickercn'], function(Control, can, base, Auth, reqwest) {
  var pageData;
  pageData = new can.Map();
  return Control.extend({
    init: function(el, data) {
      var table;
      pageData.attr('userIsContract', Auth.userIsContract());
      this.element.html(can.view('../public/view/home/dashboard/msgDashboard.html', pageData));
      $('.input-group.date input').datepicker({
        language: 'zh-CN',
        todayBtn: true,
        autoclose: true
      });
      table = $('#msgList').DataTable({
        paging: true,
        bFilter: false,
        processing: true,
        serverSide: true,
        ordering: false,
        ajax: {
          url: Auth.apiHost + "msg/page?_=" + (Date.now()),
          data: function(data) {
            data.startDate = $('#start').datepicker('getDate') || void 0;
            data.endDate = $('#end').datepicker('getDate') || void 0;
            return data;
          }
        },
        columns: [
          {
            data: 'projectName'
          }, {
            data: 'creator',
            render: function(data) {
              return (data != null ? data.username : void 0) || '';
            }
          }, {
            data: 'elc'
          }, {
            data: 'type'
          }, {
            data: 'workContent'
          }, {
            data: 'solution'
          }, {
            data: 'remark'
          }, {
            data: 'date',
            render: function(data, d, row) {
              if (data) {
                return new Date(data).toLocaleDateString();
              } else {
                return '';
              }
            }
          }
        ]
      });
      return $('#searchForm button').unbind('click').bind('click', function(e) {
        return table.ajax.reload();
      });
    }
  });
});
